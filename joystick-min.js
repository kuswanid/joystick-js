export class Joystick{#t;#i;#s;#e;#n;#h;#o;#a;#c;#r;constructor(t,i,s){const e=document.querySelector(t);this.container=t,this.options={id:"joystick",color:"#0ea5e9",size:100,borderWidth:5,autoCenter:!0,lockX:!1,lockY:!1,invertX:!1,invertY:!1,sensitivity:1,...i},this.callback=s,this.#t=document.createElement("canvas"),this.#t.id=this.options.id,this.#t.width=this.options.size,this.#t.height=this.options.size,this.#i=this.#t.getContext("2d"),this.#s=this.#t.width/2,this.#e=this.#t.height/2,this.#n=this.#s,this.#h=this.#e,this.#o=this.#t.width/5,this.#a=this.#t.width/2.5,e.appendChild(this.#t),this.#d(),this.#u(),this.#v()}#d(){this.#i.beginPath(),this.#i.arc(this.#s,this.#e,this.#a,0,2*Math.PI),this.#i.strokeStyle=this.options.color,this.#i.lineWidth=this.options.borderWidth,this.#i.stroke()}#u(){const t=this.#i.createRadialGradient(this.#n,this.#h,30,this.#n,this.#h,200);t.addColorStop(0,this.options.color),t.addColorStop(1,"#000000"),this.#i.beginPath(),this.#i.arc(this.#n,this.#h,this.#o,0,2*Math.PI),this.#i.fillStyle=t,this.#i.fill()}#l(t,i){const s=this.#t.getBoundingClientRect(),e=(t-s.x-this.#s)*(this.options.invertX?-this.options.sensitivity:this.options.sensitivity),n=(i-s.y-this.#e)*(this.options.invertY?-this.options.sensitivity:this.options.sensitivity);this.options.lockX||(this.#n=Math.max(this.#o,Math.min(this.#s+e,this.#t.width-this.#o))),this.options.lockY||(this.#h=Math.max(this.#o,Math.min(this.#e+n,this.#t.height-this.#o))),this.#i.clearRect(0,0,this.#t.width,this.#t.height),this.#d(),this.#u(),this.#m()}#p(){if(this.options.autoCenter){const{x:t=!0,y:i=!0}="object"==typeof this.options.autoCenter?this.options.autoCenter:{x:!0,y:!0};t&&(this.#n=this.#s),i&&(this.#h=this.#e),this.#i.clearRect(0,0,this.#t.width,this.#t.height),this.#d(),this.#u(),this.#m()}}#m(){const t={angle:Number((Math.atan2(this.#e-this.#h,this.#n-this.#s)*(180/Math.PI)).toFixed(2)),x:Number(((this.#n-this.#s)/(this.#t.width/2-this.#o)*100).toFixed(2)),y:Number(((this.#h-this.#e)/(this.#t.height/2-this.#o)*-100).toFixed(2))};this.callback(t)}#v(){this.#t.addEventListener("touchstart",this.#x.bind(this)),document.addEventListener("touchmove",this.#X.bind(this)),document.addEventListener("touchend",this.#Y.bind(this)),this.#t.addEventListener("mousedown",this.#g.bind(this)),document.addEventListener("mousemove",this.#w.bind(this)),document.addEventListener("mouseup",this.#M.bind(this))}#x(t){if(!this.#c){const i=t.changedTouches[0];this.#c=i.identifier,this.#r=!0}}#X(t){if(this.#r){const i=Array.from(t.changedTouches).find((t=>t.identifier===this.#c));this.#l(i.clientX,i.clientY)}}#Y(t){Array.from(t.changedTouches).find((t=>t.identifier===this.#c))&&(this.#c=null,this.#r=!1,this.#p())}#g(t){this.#r=!0,this.#l(t.clientX,t.clientY)}#w(t){this.#r&&this.#l(t.clientX,t.clientY)}#M(){this.#r=!1,this.#p()}get angle(){return Number((Math.atan2(this.#e-this.#h,this.#n-this.#s)*(180/Math.PI)).toFixed(2))}get x(){return Number(((this.#n-this.#s)/(this.#t.width/2-this.#o)*100).toFixed())}get y(){return Number(((this.#h-this.#e)/(this.#t.height/2-this.#o)*-100).toFixed())}}
